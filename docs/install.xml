<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		<title lang="en">PhpBB3 Knowledge Base Mod</title>
		<description lang="en">This mod adds a Knowledge Base to your forum, which is fully integrated with phpBB's core system. It is fully manageable through a ACP system found under the .MODS tab.</description>
		<author-notes lang="en"><![CDATA[This is a BETA version, so we do not recommend using in a live envoirenment, as it is not properly tested for bugs yet.]]></author-notes>
		<author-group>
			<author>
				<realname>Andreas Nexmann</realname>
				<email>softphp@gmail.com</email>
				<username>Imladris</username>
				<homepage>http://kb.softphp.dk</homepage>
				<contributions-group>
      		 		<contributions status="current" from="2009-05-01" position="Developer"/>
      			</contributions-group>
			</author>
			<author>
				<realname>Tom</realname>
				<email>tom.martin60@btinternet.com</email>
				<username>Poppertom69</username>
				<homepage></homepage>
				<contributions-group>
      		  		<contributions status="current" from="2009-05-01" position="Developer"/>
      			</contributions-group>
			</author>
		</author-group>
		<mod-version>0.1.0</mod-version>
		<installation>
			<level>easy</level>
			<time>600</time>
			<target-version>3.0.5</target-version>
		</installation>
		<history>
			<entry>
				<date>2009-06-18</date>
				<rev-version>0.1.0</rev-version>
				<changelog lang="en">
					<change>First BETA release of KB mod available</change>
					<change>Fixed quite a number of bugs</change>
					<change>Added feature: Article types</change>
					<change>Added feature: Article requests</change>
					<change>Added feature: E-mail article to friend</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-06-07</date>
				<rev-version>0.0.11</rev-version>
				<changelog lang="en">
					<change>Added feature: Article history</change>
					<change>Added feature: Permission to post without needing approval</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-06-04</date>
				<rev-version>0.0.10</rev-version>
				<changelog lang="lang">
					<change>Added feature: MCP KB module</change>
					<change>Added feature: Latest articles</change>
					<change>Added feature: KB extension support</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-31</date>
				<rev-version>0.0.7</rev-version>
				<changelog lang="en">
					<change>Initial Alpha release</change>
				</changelog>
			</entry>
		</history>
	</header>
	<action-group>
					<copy>
									<file from="/kb.php" to="/kb.php" />
									<file from="/adm/style/acp_kb_cat.html" to="/adm/style/acp_kb_cat.html" />
									<file from="/adm/style/acp_kb_health.html" to="/adm/style/acp_kb_health.html" />
									<file from="/adm/style/acp_kb.html" to="/adm/style/acp_kb.html" />
									<file from="/adm/style/acp_kb_types.html" to="/adm/style/acp_kb_types.html" />
									<file from="/download/kb.php" to="/download/kb.php" />
									<file from="/includes/acp/acp_kb_cats.php" to="/includes/acp/acp_kb_cats.php" />
									<file from="/includes/acp/acp_kb_types.php" to="/includes/acp/acp_kb_types.php" />
									<file from="/includes/acp/acp_kb.php" to="/includes/acp/acp_kb.php" />
									<file from="/includes/acp/info/acp_kb_cats.php" to="/includes/acp/info/acp_kb_cats.php" />
									<file from="/includes/acp/info/acp_kb_types.php" to="/includes/acp/info/acp_kb_types.php" />
									<file from="/includes/acp/info/acp_kb.php" to="/includes/acp/info/acp_kb.php" />
									<file from="/includes/constants_kb.php" to="/includes/constants_kb.php" />
									<file from="/includes/functions_kb.php" to="/includes/functions_kb.php" />
									<file from="/includes/functions_install_kb.php" to="/includes/functions_install_kb.php" />
									<file from="/includes/kb.php" to="/includes/kb.php" />
									<file from="/includes/ucp/ucp_kb.php" to="/includes/ucp/ucp_kb.php" />
									<file from="/includes/ucp/info/ucp_kb.php" to="/includes/ucp/info/ucp_kb.php" />
									<file from="/includes/mcp/mcp_kb.php" to="/includes/mcp/mcp_kb.php" />
									<file from="/includes/mcp/info/mcp_kb.php" to="/includes/mcp/info/mcp_kb.php" />
									<file from="/language/en/mods/info_acp_kb.php" to="/language/en/mods/info_acp_kb.php" />
									<file from="/language/en/mods/info_ucp_kb.php" to="/language/en/mods/info_ucp_kb.php" />
									<file from="/language/en/mods/info_mcp_kb.php" to="/language/en/mods/info_mcp_kb.php" />
									<file from="/language/en/mods/kb.php" to="/language/en/mods/kb.php" />
									<file from="/language/en/mods/permissions_kb.php" to="/language/en/mods/permissions_kb.php" />
									<file from="/styles/prosilver/template/kb/*.*" to="/styles/prosilver/template/kb/*.*" />
									<file from="/styles/prosilver/theme/kb.css" to="/styles/prosilver/theme/kb.css" />
									<file from="/styles/prosilver/theme/images/rate_star.gif" to="/styles/prosilver/theme/images/rate_star.gif" />
									<file from="/styles/prosilver/theme/images/social_bookmarking/*.*" to="/styles/prosilver/theme/images/social_bookmarking/*.*" />
									<file from="/umil/umil.php" to="/umil/umil.php" />
							</copy>
						<open src="/adm/style/acp_attachments.html">
							<edit>
								<find><![CDATA[		<dl>
			<dt><label for="allow_in_pm">{L_ALLOW_IN_PM}:</label></dt>
			<dd><input type="checkbox" class="radio" id="allow_in_pm" name="allow_in_pm" value="1"<!-- IF ALLOW_IN_PM --> checked="checked"<!-- ENDIF --> /></dd>
		</dl>]]></find>
								<action type="after-add"><![CDATA[		<dl>
			<dt><label for="allow_in_pm">{L_ALLOW_IN_KB}:</label></dt>
			<dd><input type="checkbox" class="radio" id="allow_in_kb" name="allow_in_kb" value="1"<!-- IF ALLOW_IN_KB --> checked="checked"<!-- ENDIF --> /></dd>
		</dl>]]></action>
							</edit>
							<edit>
								<find><![CDATA[						'ALLOW_GROUP'			=> $ext_group_row['allow_group'],
							'ALLOW_IN_PM'			=> $ext_group_row['allow_in_pm'],]]></find>
								<action type="add-after"><![CDATA[						// KB Mod Begin
							'ALLOW_IN_KB'			=> $ext_group_row['allow_in_kb'],
							// KB Mod End]]></action>
							</edit>
							<edit>
								<find><![CDATA[<!-- ELSE --><br /><span>&raquo; {L_ALLOWED_IN_PM_POST}</span><!-- ENDIF -->]]></find>
								<inline-edit>
									<inline-find><![CDATA[<!-- ENDIF -->]]></inline-find>
									<inline-action type="after-add"><![CDATA[<br /><span><!-- IF groups.S_ALLOWED_IN_KB -->&raquo; {L_ALLOW_IN_KB}<!-- ELSE -->&raquo; {L_NOT_ALLOWED_IN_KB}<!-- ENDIF --></span>]]></inline-action>
								</inline-edit>
							</edit>
						</open>
						<open src="/includes/cache.php">
							<edit>
								<find><![CDATA[		}

		return $icons;
	}]]></find>
								<action type="after-add"><![CDATA[	// Mod KB Begin
	/**
	* Obtain article types
	*/
	function obtain_article_types()
	{
		if (($types = $this->get('_kb_types')) === false)
		{
			global $db;

			// Article types
			$sql = 'SELECT *
				FROM ' . KB_TYPE_TABLE . '
				ORDER BY type_order ASC';
			$result = $db->sql_query($sql);

			$types = array();
			while ($row = $db->sql_fetchrow($result))
			{
				$types[$row['type_id']]['type_id'] = (int) $row['type_id'];
				$types[$row['type_id']]['icon'] = (int) $row['icon_id'];
				$types[$row['type_id']]['title'] = $row['type_title'];
				$types[$row['type_id']]['prefix'] = $row['type_before'];
				$types[$row['type_id']]['suffix'] = $row['type_after'];
				$types[$row['type_id']]['img'] = $row['type_image'];
				$types[$row['type_id']]['width'] = (int) $row['type_img_w'];
				$types[$row['type_id']]['height'] = (int) $row['type_img_h'];
				$types[$row['type_id']]['order'] = (int) $row['type_order'];
			}
			$db->sql_freeresult($result);

			$this->put('_kb_types', $types);
		}

		return $types;
	}
	// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[			$extensions = array(
				'_allowed_post'	=> array(),
				'_allowed_pm'	=> array(),
]]></find>
								<action type="after-add"><![CDATA[				// Mod KB Begin
				'_allowed_kb'	=> array(),
				// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[					'max_filesize'	=> (int) $row['max_filesize'],
					'allow_group'	=> $row['allow_group'],
					'allow_in_pm'	=> $row['allow_in_pm'],]]></find>
								<action type="after-add"><![CDATA[				// Mod KB Begin
					'allow_in_kb'	=> $row['allow_in_kb'],
					// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[			if ($row['allow_in_pm'])
				{
					$extensions['_allowed_pm'][$extension] = 0;
				}]]></find>
								<action type="after-add"><![CDATA[				
				// Mod KB Begin
				if ($row['allow_in_kb'])
				{
					$extensions['_allowed_kb'][$extension] = 0;
				}
				// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[	else if ($forum_id === true)
		{
			return $extensions;
		}]]></find>
								<action type="after-add"><![CDATA[		// Mod KB Begin
		else if($forum_id == 'kb')
		{
			// We are checking for the knowledge base, therefore we only need to get the kb extensions...
			$return = array('_allowed_' => array());

			foreach ($extensions['_allowed_kb'] as $extension => $check)
			{
				$return['_allowed_'][$extension] = 0;
				$return[$extension] = $extensions[$extension];
			}

			$extensions = $return;
		}
		// Mod KB End]]></action>
							</edit>
						</open>
						<open src="/includes/functions.php">
											<edit>
							<find><![CDATA[		'U_RESTORE_PERMISSIONS'	=> ($user->data['user_perm_from'] && $auth->acl_get('a_switchperm')) ? append_sid("{$phpbb_root_path}ucp.$phpEx", 'mode=restore_perm') : '',]]></find>
															<action type="after-add"><![CDATA[		'U_KB'					=> append_sid("kb.php"),
		'L_KB_EXPLAIN'			=> $user->lang['KB_EXPLAIN'],
		'L_KB'					=> $user->lang['KNOWLEDGE_BASE'],]]></action>
													</edit>
									</open>
						<open src="/includes/acp/acp_attachments.php">
							<edit>
								<find><![CDATA[						$allowed_forums	= request_var('allowed_forums', array(0));
						$allow_in_pm	= (isset($_POST['allow_in_pm'])) ? true : false;]]></find>
								<action type="after-add"><![CDATA[						// Mod KB Begin
						$allow_in_kb	= (isset($_POST['allow_in_kb'])) ? true : false;
						// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[							'allowed_forums'=> ($forum_select) ? serialize($allowed_forums) : '',
							'allow_in_pm'	=> ($allow_in_pm) ? 1 : 0,]]></find>
								<action type="after-add"><![CDATA[							// Mod KB Begin
							'allow_in_kb'	=> ($allow_in_kb) ? 1 : 0,
							// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[								'allow_group'	=> 1,
								'allow_in_pm'	=> 1,]]></find>
								<action type="after-add"><![CDATA[								// Mod KB Begin
								'allow_in_kb'	=> 1,
								// Mod KB End]]></action>
							</edit>
							<edit>
								<find><![CDATA[						'S_ADD_SPACER'		=> $s_add_spacer,
						'S_ALLOWED_IN_PM'	=> ($row['allow_in_pm']) ? true : false,]]></find>
								<action type="after-add"><![CDATA[						// Mod KB Begin
						'S_ALLOWED_IN_KB'	=> ($row['allow_in_kb']) ? true : false,
						// Mod KB End]]></action>
							</edit>
						</open>
							<open src="/language/en/common.php">
											<edit>
							<find><![CDATA[	'KIB'					=> 'KiB',]]></find>
															<action type="after-add"><![CDATA[	'KNOWLEDGE_BASE'		=> 'Knowledge Base',
	'KB_EXPLAIN'			=> 'Knowledge Base',]]></action>
													</edit>
									</open>
							<open src="/language/en/acp/attachments.php">
								<edit>
									<find><![CDATA[	'ALLOW_IN_PM'						=> 'Allowed in private messaging',]]></find>
									<action type="after-add"><![CDATA[	// Mod KB Begin
	'ALLOW_IN_KB'						=> 'Allowed in the Knowledge Base',
	'NOT_ALLOWED_IN_KB'					=> 'Not allowed in the Knowledge Base',
	// Mod KB End]]></action>
								</edit>
							</open>	
							<open src="/styles/prosilver/template/overall_header.html">
											<edit>
							<find><![CDATA[<li class="icon-faq"><a href="{U_FAQ}" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>]]></find>
															<action type="before-add"><![CDATA[<li class="icon-faq"><a href="{U_KB}" title="{L_KB_EXPLAIN}">{L_KB}</a></li>]]></action>
													</edit>
									</open>
							<open src="/styles/prosilver/theme/stylesheet.css">
											<edit>
							<find><![CDATA[@import url("colours.css");]]></find>
															<action type="after-add"><![CDATA[@import url("kb.css");]]></action>
													</edit>
									</open>
							<diy-instructions lang="en"><![CDATA[After saving all files, please login as admin. Then direct your browser to kb.php and follow the install steps there. Afterwards go to the ACP, then clear your cache, refresh your theme and go to the permissions screen. Here you will be able to set permissions for your new Knowledge Base, you have to do so for ALL groups before they are able to visit the KB.]]></diy-instructions>
				</action-group>
</mod>